---
# DEFAULT FILE FOR INDEXIMA 

# PREREQUISITES 
install_path: "/opt"
service_user: "root"
service_group: "{{ service_user }}"
java_name: "{{ install_path }}/jdk1.8.0_05"
java_archive: "{{ install_path }}/jdk-8u5-linux-x64.tar.gz"
java_package_centos: java-1.8.0-openjdk # Redhat family
java_package_debian: openjdk-8-jdk # Debian family
java_jdk_rhel: java-1.8.0-openjdk-devel #OpenJDK 8 JDK
java_jre_debian: openjdk-8-jre-headless
hadoop_version_major: "2"
hadoop_version: "{% if hadoop_version_major|int == 3 %}3.1.4{% else %}2.8.3{% endif %}"
hadoop_file: hadoop-{{ hadoop_version }}
#hadoop_url: http://archive.apache.org/dist/hadoop/common/{{ hadoop_file }}/{{ hadoop_file }}.tar.gz
hadoop_url: "{{ indexima_base_url }}/libs/{{ hadoop_file }}.tar.gz"
hadoop_archive: "{{ install_path }}/{{ hadoop_file }}.tar.gz"
hadoop_base: "{{ install_path }}/hadoop-{{ hadoop_version }}"


# STANDALONE 
# DON'T CHANGE 
version: 2021.2.1390.1
internal_host: "{{ hostvars[inventory_hostname]['ansible_default_ipv4']['address'] | d('LOCAL_IP') }}"
internet: 1
internal_use: 0
is_master: 0
systemd: true
indexima_base_url: "https://download.indexima.com"
indexima_path: "{{ install_path }}/indexima"
indexima_logs_path: "/var/log/indexima"
indexima_log_dir: "{{ indexima_logs_path }}/logs"
indexima_hive_log_dir: "{{ indexima_logs_path }}/hive"
indexima_history_dir: "{{ indexima_logs_path }}/history"
indexima_history_export: "{{ indexima_logs_path }}/history_csv"
indexima_logs:
  - "{{ indexima_log_dir }}"
  - "{{ indexima_hive_log_dir }}"
  - "{{ indexima_history_dir }}"
  - "{{ indexima_history_export }}"
indexima_version: "{{ indexima_release }}{% if indexima_build is defined %}.{{ indexima_build }}{% endif %}{% if indexima_sp is defined %}.{{ indexima_sp }}{% endif %}"

# INDEXIMA INSTALLER 
indexima_file: "indexima-installer-{% if hadoop_version_major|int == 3 %}galactica-hadoop3-{% endif %}{{ indexima_version }}.zip"
indexima_gold: "{{ indexima_release | replace('.', '') }}-{{ indexima_build | omitempty}}"
indexima_url: "{{ indexima_base_url }}/release/{{ indexima_release }}/{{ indexima_sp |d('') }}"
galactica_url: "{{ indexima_url }}/{{ indexima_file }}"
indexima_archive: "{{ indexima_path }}/{{ indexima_file }}"
galactica_path: "{{ indexima_path }}/galactica"

# DEV CONSOLE
admin_type: local
vd2_port: 8082
vd_data: "$HOME/visualdoop-data"
vd2_file: indexima-installer-visual2-{{ indexima_version }}.zip
vd2_archive: "{{ indexima_path }}/{{ vd2_file }}"
vd2_url: "{{ indexima_url }}/{{ vd2_file }}"
vd2_path: "{{ indexima_path }}/visualdoop2"
vd_path: "{{ indexima_path }}/visualdoop"
vd_cluster_mode: 0
vd_cluster_only: 0
vd_project_mode: 1

# DEFAULT ADMIN USER IN VD2 
admin_users: "admin"

# CONFIG PARAMETERS
nodes: 1
node_connect_timeout: 120
node_port: 19999
monitor_port: 9999
cores: "{{ ansible_processor_vcpus|int }}"
ram: "{{ ansible_memtotal_mb|int }}"
indexima_ram: "{{ (ram|float * 0.70) | int }}"

disk: 1
warehouse_type: local
warehouse: "{{ indexima_path }}/warehouse"
readers: "{% if cores|int > 4 %}{{ (cores|int / 2)|int }}{% else %}{{ cores|int }}{% endif %}" # Deprecated since 2021.3
loaders: "{% if cores|int > 4 %}{{ (cores|int / 2)|int }}{% else %}{{ cores|int }}{% endif %}"
queries: "{{ (cores|int * 8)|int }}"
hybrids: 6 # Deprecated since 2021.2
partitions: "{{ (cores|int * nodes|int)|int }}"
partitions_number: "{{ (cores|int * nodes|int)|int }}" # Duplicate parameter for backward compatibility. Will be removed in the future
indexima_service_user: "{{ service_user }}"

# DRIVERS
drivers: 0
# Driver URL> if you want to download the required jdbc drivers from a custom http url, set drivers_url to 1, and
# Fill the driver_list with the names of the files, These parameters are unset by default
#drivers_url: 0
#driver_list: []

# Cloud Credentials
#google_credentials: "{{ galactica_path }}/conf"
#aws_access_key_id: 
#aws_secret_access_key:

# AUTH
monitor_auth: false
monitor_rights: false
monitor_api_key: ChangeMe
ldap: false
#ldap_url: 
#ldap_user_dnpattern: 
#ldap_group_dnpattern: 
#ldap_group_classkey: 
#ldap_group_membershipkey: 
#ldap_group_filter: 

galactica_users: admin
galactica_passwords: admin
galactica_admins: admin
main_connection_user: admin
main_connection_password: admin

kerberos_full: 0
kerberos_indexima: "{{ kerberos_full }}"
kerberos_hdfs: "{{ kerberos_full }}"
kerberos_zookeeper: "{{ kerberos_full }}"

# HADOOP
yarn_deploy: 0
yarn_classpath: "{{ yarn_deploy }}"
hive_port: 10000
hive_type: binary
yarn_resourcemanager_hostname: localhost
yarn_memory: "{{ ram }}"
yarn_tmp_dir: hdfs://localhost:8020/tmp/indexima
yarn_name: Indexima

# HD INSIGHT
core_site_path: "{{ hadoop_base }}/etc/hadoop"
azure_hadoop_jars_path: "{{ hadoop_base }}/share/hadoop/common"
fs_adl_oauth2_client_id: "ADL_CLIENT_ID"
fs_adl_oauth2_access_token_provider_type: "ClientCredential"
fs_adl_oauth2_tenant_id: "ADL_TENANT_ID"
dfs_adls_oauth2_password: "ADL_SECRET"
fs_defaultFS: "adl://BUCKET_NAME.azuredatalakestore.net"
fs_adl_impl: "org.apache.hadoop.fs.adl.AdlFileSystem"
fs_AbstractFileSystem_adl_impl: "org.apache.hadoop.fs.adl.Adl"

# MISC
clean: 1
ssl: 0
ha: 1
dynamic: 1
galactica_gc_options: "-XX:+UseConcMarkSweepGC -XX:-OmitStackTraceInFastThrow"
galactica_perf_mode: stable
service_master_ip: "{% for host in ansible_play_hosts |default(['localhost']) %}{% if hostvars[host]['is_master'] %}{{ hostvars[host]['internal_host'] }}{% endif %}{% endfor %}"
service_local_ip: "{{ internal_host |d('LOCAL_IP') }}"

log4j2_retention: 10